(function(b){b.fn.formset=function(v){var a=b.extend({},b.fn.formset.defaults,v);var q=b(this);var t=q.parent();var m=function(e,d,g){var c=new RegExp("("+d+"-(\\d+|__prefix__))");var f=d+"-"+g;if(b(e).prop("for")){b(e).prop("for",b(e).prop("for").replace(c,f))}if(e.id){e.id=e.id.replace(c,f)}if(e.name){e.name=e.name.replace(c,f)}};var s=b("#id_"+a.prefix+"-TOTAL_FORMS").prop("autocomplete","off");var r=parseInt(s.val(),10);var o=b("#id_"+a.prefix+"-MAX_NUM_FORMS").prop("autocomplete","off");var n=o.val()===""||(o.val()-s.val())>0;q.each(function(c){b(this).not("."+a.emptyCssClass).addClass(a.formCssClass)});if(q.length&&n){var p=a.addButton;if(p===null){if(q.prop("tagName")==="TR"){var u=this.eq(-1).children().length;t.append('<tr class="'+a.addCssClass+'"><td colspan="'+u+'"><a href="#">'+a.addText+"</a></tr>");p=t.find("tr:last a")}else{q.filter(":last").after('<div class="'+a.addCssClass+'"><a href="#">'+a.addText+"</a></div>");p=q.filter(":last").next().find("a")}}p.click(function(e){e.preventDefault();var c=b("#"+a.prefix+"-empty");var d=c.clone(true);d.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr("id",a.prefix+"-"+r);if(d.is("tr")){d.children(":last").append('<div><a class="'+a.deleteCssClass+'" href="#">'+a.deleteText+"</a></div>")}else{if(d.is("ul")||d.is("ol")){d.append('<li><a class="'+a.deleteCssClass+'" href="#">'+a.deleteText+"</a></li>")}else{d.children(":first").append('<span><a class="'+a.deleteCssClass+'" href="#">'+a.deleteText+"</a></span>")}}d.find("*").each(function(){m(this,a.prefix,s.val())});d.insertBefore(b(c));b(s).val(parseInt(s.val(),10)+1);r+=1;if((o.val()!=="")&&(o.val()-s.val())<=0){p.parent().hide()}d.find("a."+a.deleteCssClass).click(function(f){f.preventDefault();d.remove();r-=1;if(a.removed){a.removed(d)}b(document).trigger("formset:removed",[d,a.prefix]);var j=b("."+a.formCssClass);b("#id_"+a.prefix+"-TOTAL_FORMS").val(j.length);if((o.val()==="")||(o.val()-j.length)>0){p.parent().show()}var i,g;var h=function(){m(this,a.prefix,i)};for(i=0,g=j.length;i<g;i++){m(b(j).get(i),a.prefix,i);b(j.get(i)).find("*").each(h)}});if(a.added){a.added(d)}b(document).trigger("formset:added",[d,a.prefix])})}return this};b.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null,addButton:null};b.fn.tabularFormset=function(k){var l=b(this);var i=function(c){b(l.selector).not(".add-row").removeClass("row1 row2").filter(":even").addClass("row1").end().filter(":odd").addClass("row2")};var a=function(){if(typeof DateTimeShortcuts!=="undefined"){b(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var j=function(){if(typeof SelectFilter!=="undefined"){b(".selectfilter").each(function(e,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],false)});b(".selectfilterstacked").each(function(e,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],true)})}};var h=function(c){c.find(".prepopulated_field").each(function(){var d=b(this),f=d.find("input, select, textarea"),g=f.data("dependency_list")||[],e=[];b.each(g,function(o,p){e.push("#"+c.find(".field-"+p).find("input, select, textarea").attr("id"))});if(e.length){f.prepopulate(e,f.attr("maxlength"))}})};l.formset({prefix:k.prefix,addText:k.addText,formCssClass:"dynamic-"+k.prefix,deleteCssClass:"inline-deletelink",deleteText:k.deleteText,emptyCssClass:"empty-form",removed:i,added:function(c){h(c);a();j();i(c)},addButton:k.addButton});return l};b.fn.stackedFormset=function(k){var l=b(this);var j=function(c){b(l.selector).find(".inline_label").each(function(e){var d=e+1;b(this).html(b(this).html().replace(/(#\d+)/g,"#"+d))})};var a=function(){if(typeof DateTimeShortcuts!=="undefined"){b(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var i=function(){if(typeof SelectFilter!=="undefined"){b(".selectfilter").each(function(e,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],false)});b(".selectfilterstacked").each(function(e,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],true)})}};var h=function(c){c.find(".prepopulated_field").each(function(){var d=b(this),f=d.find("input, select, textarea"),g=f.data("dependency_list")||[],e=[];b.each(g,function(o,p){e.push("#"+c.find(".form-row .field-"+p).find("input, select, textarea").attr("id"))});if(e.length){f.prepopulate(e,f.attr("maxlength"))}})};l.formset({prefix:k.prefix,addText:k.addText,formCssClass:"dynamic-"+k.prefix,deleteCssClass:"inline-deletelink",deleteText:k.deleteText,emptyCssClass:"empty-form",removed:j,added:function(c){h(c);a();i();j(c)},addButton:k.addButton});return l};b(document).ready(function(){b(".js-inline-admin-formset").each(function(){var d=b(this).data(),a=d.inlineFormset;switch(d.inlineType){case"stacked":b(a.name+"-group .inline-related").stackedFormset(a.options);break;case"tabular":b(a.name+"-group .tabular.inline-related tbody tr").tabularFormset(a.options);break}})})})(django.jQuery);