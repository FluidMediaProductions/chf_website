(function(){var a={calendars:[],calendarInputs:[],clockInputs:[],dismissClockFunc:[],dismissCalendarFunc:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",timezoneWarningClass:"timezonewarning",timezoneOffset:0,init:function(){var b=document.getElementsByTagName("body")[0];var d=b.getAttribute("data-admin-utc-offset");if(d){var g=new Date().getTimezoneOffset()*-60;a.timezoneOffset=g-d}var c=document.getElementsByTagName("input");for(var e=0;e<c.length;e++){var f=c[e];if(f.getAttribute("type")==="text"&&f.className.match(/vTimeField/)){a.addClock(f);a.addTimezoneWarning(f)}else{if(f.getAttribute("type")==="text"&&f.className.match(/vDateField/)){a.addCalendar(f);a.addTimezoneWarning(f)}}}},now:function(){var b=document.getElementsByTagName("body")[0];var c=b.getAttribute("data-admin-utc-offset");if(c){var d=new Date();var e=d.getTimezoneOffset()*-60;d.setTime(d.getTime()+1000*(c-e));return d}else{return new Date()}},addTimezoneWarning:function(f){var g=django.jQuery;var c=a.timezoneWarningClass;var e=a.timezoneOffset/3600;if(!e){return}if(g(f).siblings("."+c).length){return}var d;if(e>0){d=ngettext("Note: You are %s hour ahead of server time.","Note: You are %s hours ahead of server time.",e)}else{e*=-1;d=ngettext("Note: You are %s hour behind server time.","Note: You are %s hours behind server time.",e)}d=interpolate(d,[e]);var b=g("<span>");b.attr("class",c);b.text(d);g(f).parent().append(g("<br>")).append(b)},addClock:function(j){var g=a.clockInputs.length;a.clockInputs[g]=j;a.dismissClockFunc[g]=function(){a.dismissClock(g);return true};var i=document.createElement("span");i.className=a.shortCutsClass;j.parentNode.insertBefore(i,j.nextSibling);var f=document.createElement("a");f.setAttribute("href","#");f.appendChild(document.createTextNode(gettext("Now")));addEvent(f,"click",function(l){l.preventDefault();a.handleClockQuicklink(g,-1)});var h=document.createElement("a");h.setAttribute("href","#");h.id=a.clockLinkName+g;addEvent(h,"click",function(l){l.preventDefault();l.stopPropagation();a.openClock(g)});quickElement("span",h,"","class","clock-icon","title",gettext("Choose a Time"));i.appendChild(document.createTextNode("\u00A0"));i.appendChild(f);i.appendChild(document.createTextNode("\u00A0|\u00A0"));i.appendChild(h);var e=document.createElement("div");e.style.display="none";e.style.position="absolute";e.className="clockbox module";e.setAttribute("id",a.clockDivName+g);document.body.appendChild(e);addEvent(e,"click",cancelEventPropagation);quickElement("h2",e,gettext("Choose a time"));var k=quickElement("ul",e);k.className="timelist";var b=quickElement("a",quickElement("li",k),gettext("Now"),"href","#");addEvent(b,"click",function(l){l.preventDefault();a.handleClockQuicklink(g,-1)});b=quickElement("a",quickElement("li",k),gettext("Midnight"),"href","#");addEvent(b,"click",function(l){l.preventDefault();a.handleClockQuicklink(g,0)});b=quickElement("a",quickElement("li",k),gettext("6 a.m."),"href","#");addEvent(b,"click",function(l){l.preventDefault();a.handleClockQuicklink(g,6)});b=quickElement("a",quickElement("li",k),gettext("Noon"),"href","#");addEvent(b,"click",function(l){l.preventDefault();a.handleClockQuicklink(g,12)});b=quickElement("a",quickElement("li",k),gettext("6 p.m."),"href","#");addEvent(b,"click",function(l){l.preventDefault();a.handleClockQuicklink(g,18)});var c=quickElement("p",e);c.className="calendar-cancel";var d=quickElement("a",c,gettext("Cancel"),"href","#");addEvent(d,"click",function(l){l.preventDefault();a.dismissClock(g)});django.jQuery(document).bind("keyup",function(l){if(l.which===27){a.dismissClock(g);l.preventDefault()}})},openClock:function(c){var d=document.getElementById(a.clockDivName+c);var b=document.getElementById(a.clockLinkName+c);if(getStyle(document.body,"direction")!=="rtl"){d.style.left=findPosX(b)+17+"px"}else{d.style.left=findPosX(b)-110+"px"}d.style.top=Math.max(0,findPosY(b)-30)+"px";d.style.display="block";addEvent(document,"click",a.dismissClockFunc[c])},dismissClock:function(b){document.getElementById(a.clockDivName+b).style.display="none";removeEvent(document,"click",a.dismissClockFunc[b])},handleClockQuicklink:function(b,e){var c;if(e===-1){c=a.now()}else{c=new Date(1970,1,1,e,0,0,0)}a.clockInputs[b].value=c.strftime(get_format("TIME_INPUT_FORMATS")[0]);a.clockInputs[b].focus();a.dismissClock(b)},addCalendar:function(j){var g=a.calendars.length;a.calendarInputs[g]=j;a.dismissCalendarFunc[g]=function(){a.dismissCalendar(g);return true};var i=document.createElement("span");i.className=a.shortCutsClass;j.parentNode.insertBefore(i,j.nextSibling);var m=document.createElement("a");m.setAttribute("href","#");m.appendChild(document.createTextNode(gettext("Today")));addEvent(m,"click",function(p){p.preventDefault();a.handleCalendarQuickLink(g,0)});var e=document.createElement("a");e.setAttribute("href","#");e.id=a.calendarLinkName+g;addEvent(e,"click",function(p){p.preventDefault();p.stopPropagation();a.openCalendar(g)});quickElement("span",e,"","class","date-icon","title",gettext("Choose a Date"));i.appendChild(document.createTextNode("\u00A0"));i.appendChild(m);i.appendChild(document.createTextNode("\u00A0|\u00A0"));i.appendChild(e);var l=document.createElement("div");l.style.display="none";l.style.position="absolute";l.className="calendarbox module";l.setAttribute("id",a.calendarDivName1+g);document.body.appendChild(l);addEvent(l,"click",cancelEventPropagation);var f=quickElement("div",l);var k=quickElement("a",f,"<","href","#");k.className="calendarnav-previous";addEvent(k,"click",function(p){p.preventDefault();a.drawPrev(g)});var n=quickElement("a",f,">","href","#");n.className="calendarnav-next";addEvent(n,"click",function(p){p.preventDefault();a.drawNext(g)});var o=quickElement("div",l,"","id",a.calendarDivName2+g);o.className="calendar";a.calendars[g]=new Calendar(a.calendarDivName2+g,a.handleCalendarCallback(g));a.calendars[g].drawCurrent();var h=quickElement("div",l);h.className="calendar-shortcuts";var c=quickElement("a",h,gettext("Yesterday"),"href","#");addEvent(c,"click",function(p){p.preventDefault();a.handleCalendarQuickLink(g,-1)});h.appendChild(document.createTextNode("\u00A0|\u00A0"));c=quickElement("a",h,gettext("Today"),"href","#");addEvent(c,"click",function(p){p.preventDefault();a.handleCalendarQuickLink(g,0)});h.appendChild(document.createTextNode("\u00A0|\u00A0"));c=quickElement("a",h,gettext("Tomorrow"),"href","#");addEvent(c,"click",function(p){p.preventDefault();a.handleCalendarQuickLink(g,+1)});var b=quickElement("p",l);b.className="calendar-cancel";var d=quickElement("a",b,gettext("Cancel"),"href","#");addEvent(d,"click",function(p){p.preventDefault();a.dismissCalendar(g)});django.jQuery(document).bind("keyup",function(p){if(p.which===27){a.dismissCalendar(g);p.preventDefault()}})},openCalendar:function(d){var i=document.getElementById(a.calendarDivName1+d);var b=document.getElementById(a.calendarLinkName+d);var f=a.calendarInputs[d];if(f.value){var h=get_format("DATE_INPUT_FORMATS")[0];var c=f.value.strptime(h);var g=c.getUTCFullYear();var e=c.getUTCMonth()+1;var j=/\d{4}/;if(j.test(g.toString())&&e>=1&&e<=12){a.calendars[d].drawDate(e,g,c)}}if(getStyle(document.body,"direction")!=="rtl"){i.style.left=findPosX(b)+17+"px"}else{i.style.left=findPosX(b)-180+"px"}i.style.top=Math.max(0,findPosY(b)-75)+"px";i.style.display="block";addEvent(document,"click",a.dismissCalendarFunc[d])},dismissCalendar:function(b){document.getElementById(a.calendarDivName1+b).style.display="none";removeEvent(document,"click",a.dismissCalendarFunc[b])},drawPrev:function(b){a.calendars[b].drawPreviousMonth()},drawNext:function(b){a.calendars[b].drawNextMonth()},handleCalendarCallback:function(b){var c=get_format("DATE_INPUT_FORMATS")[0];c=c.replace("\\","\\\\");c=c.replace("\r","\\r");c=c.replace("\n","\\n");c=c.replace("\t","\\t");c=c.replace("'","\\'");return function(g,e,f){a.calendarInputs[b].value=new Date(g,e-1,f).strftime(c);a.calendarInputs[b].focus();document.getElementById(a.calendarDivName1+b).style.display="none"}},handleCalendarQuickLink:function(b,e){var c=a.now();c.setDate(c.getDate()+e);a.calendarInputs[b].value=c.strftime(get_format("DATE_INPUT_FORMATS")[0]);a.calendarInputs[b].focus();a.dismissCalendar(b)}};addEvent(window,"load",a.init);window.DateTimeShortcuts=a})();