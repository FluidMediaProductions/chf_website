(function(b){function a(c){if(c.tagName.toLowerCase()!=="form"){return a(c.parentNode)}return c}window.SelectFilter={init:function(g,c,q){if(g.match(/__prefix__/)){return}var d=document.getElementById(g);d.id+="_from";d.className="filtered";var w=d.parentNode.getElementsByTagName("p");for(var y=0;y<w.length;y++){if(w[y].className.indexOf("info")!==-1){d.parentNode.removeChild(w[y])}else{if(w[y].className.indexOf("help")!==-1){d.parentNode.insertBefore(w[y],d.parentNode.firstChild)}}}var o=quickElement("div",d.parentNode);o.className=q?"selector stacked":"selector";var v=quickElement("div",o);v.className="selector-available";var m=quickElement("h2",v,interpolate(gettext("Available %s")+" ",[c]));quickElement("span",m,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[c]));var e=quickElement("p",v,"","id",g+"_filter");e.className="selector-filter";var h=quickElement("label",e,"","for",g+"_input");quickElement("span",h,"","class","help-tooltip search-label-icon","title",interpolate(gettext("Type into this box to filter down the list of available %s."),[c]));e.appendChild(document.createTextNode(" "));var k=quickElement("input",e,"","type","text","placeholder",gettext("Filter"));k.id=g+"_input";v.appendChild(d);var n=quickElement("a",v,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[c]),"href","#","id",g+"_add_all_link");n.className="selector-chooseall";var p=quickElement("ul",o);p.className="selector-chooser";var u=quickElement("a",quickElement("li",p),gettext("Choose"),"title",gettext("Choose"),"href","#","id",g+"_add_link");u.className="selector-add";var x=quickElement("a",quickElement("li",p),gettext("Remove"),"title",gettext("Remove"),"href","#","id",g+"_remove_link");x.className="selector-remove";var s=quickElement("div",o);s.className="selector-chosen";var f=quickElement("h2",s,interpolate(gettext("Chosen %s")+" ",[c]));quickElement("span",f,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of chosen %s. You may remove some by selecting them in the box below and then clicking the "Remove" arrow between the two boxes.'),[c]));var j=quickElement("select",s,"","id",g+"_to","multiple","multiple","size",d.size,"name",d.getAttribute("name"));j.className="filtered";var A=quickElement("a",s,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[c]),"href","#","id",g+"_remove_all_link");A.className="selector-clearall";d.setAttribute("name",d.getAttribute("name")+"_old");var l=function(C,B,i,E,D){if(B.className.indexOf("active")!==-1){i(E,D);SelectFilter.refresh_icons(g)}C.preventDefault()};addEvent(n,"click",function(i){l(i,this,SelectBox.move_all,g+"_from",g+"_to")});addEvent(u,"click",function(i){l(i,this,SelectBox.move,g+"_from",g+"_to")});addEvent(x,"click",function(i){l(i,this,SelectBox.move,g+"_to",g+"_from")});addEvent(A,"click",function(i){l(i,this,SelectBox.move_all,g+"_to",g+"_from")});addEvent(k,"keypress",function(i){SelectFilter.filter_key_press(i,g)});addEvent(k,"keyup",function(i){SelectFilter.filter_key_up(i,g)});addEvent(k,"keydown",function(i){SelectFilter.filter_key_down(i,g)});addEvent(o,"change",function(i){if(i.target.tagName==="SELECT"){SelectFilter.refresh_icons(g)}});addEvent(o,"dblclick",function(i){if(i.target.tagName==="OPTION"){if(i.target.closest("select").id===g+"_to"){SelectBox.move(g+"_to",g+"_from")}else{SelectBox.move(g+"_from",g+"_to")}SelectFilter.refresh_icons(g)}});addEvent(a(d),"submit",function(){SelectBox.select_all(g+"_to")});SelectBox.init(g+"_from");SelectBox.init(g+"_to");SelectBox.move(g+"_from",g+"_to");if(!q){var r=b(d);var t=b(j);var z=function(){t.height(b(e).outerHeight()+r.outerHeight())};if(r.outerHeight()>0){z()}else{t.closest("fieldset").one("show.fieldset",z)}}SelectFilter.refresh_icons(g)},any_selected:function(f){var c=false;try{f.attr("required","required");c=f.is(":valid");f.removeAttr("required")}catch(d){c=f.find("option:selected").length>0}return c},refresh_icons:function(c){var e=b("#"+c+"_from");var d=b("#"+c+"_to");b("#"+c+"_add_link").toggleClass("active",SelectFilter.any_selected(e));b("#"+c+"_remove_link").toggleClass("active",SelectFilter.any_selected(d));b("#"+c+"_add_all_link").toggleClass("active",e.find("option").length>0);b("#"+c+"_remove_all_link").toggleClass("active",d.find("option").length>0)},filter_key_press:function(d,c){var e=document.getElementById(c+"_from");if((d.which&&d.which===13)||(d.keyCode&&d.keyCode===13)){e.selectedIndex=0;SelectBox.move(c+"_from",c+"_to");e.selectedIndex=0;d.preventDefault();return false}},filter_key_up:function(e,d){var f=document.getElementById(d+"_from");var c=f.selectedIndex;SelectBox.filter(d+"_from",document.getElementById(d+"_input").value);f.selectedIndex=c;return true},filter_key_down:function(d,c){var f=document.getElementById(c+"_from");if((d.which&&d.which===39)||(d.keyCode&&d.keyCode===39)){var e=f.selectedIndex;SelectBox.move(c+"_from",c+"_to");f.selectedIndex=(e===f.length)?f.length-1:e;return false}if((d.which&&d.which===40)||(d.keyCode&&d.keyCode===40)){f.selectedIndex=(f.length===f.selectedIndex+1)?0:f.selectedIndex+1}if((d.which&&d.which===38)||(d.keyCode&&d.keyCode===38)){f.selectedIndex=(f.selectedIndex===0)?f.length-1:f.selectedIndex-1}return true}};addEvent(window,"load",function(c){b("select.selectfilter, select.selectfilterstacked").each(function(){var d=b(this),e=d.data();SelectFilter.init(d.attr("id"),e.fieldName,parseInt(e.isStacked,10))})})})(django.jQuery);